# 메세지큐를 직접 써볼거임.

1. RabbitMQ

```bash
docker run -d --name rabbitmq \
  -p 5672:5672 -p 15672:15672 \
  -e RABBITMQ_DEFAULT_USER=guest \
  -e RABBITMQ_DEFAULT_PASS=guest \
  rabbitmq:3-management
```

## TODO

- Outbox
  - Outbox 패턴을 적용해서, 트랜잭션이 성공하면 메시지를 발행하는 구조로 만들기
  - (별도의 테이블을 만들어서, 메시지를 저장하고, CDC로 RabbitMQ로 발행하는 구조)

## 만드려는 것 : 회원가입

- 회원가입에 성공하면,
  - 사용자에게 메일 보내고, (SMTP, JavaMailSender)
  - 이벤트성 쿠폰을 발급하고,
  - 사용자 증감 통계 갱신 이벤트 발행 (될진 모르겠지만 : 이건 여러개 쌓여도 하나만 발행되도록)

## 비교

- HEAD : 99614f0812d31db7d4594c781003e4c334c1236e
  - 그냥 단순하게 구현한 구조.
  - 장점
    - 부담 없이 구현 가능
  - 단점
    - 회원가입 성공이후 메일 발송, 쿠폰 발급 모두 동기적으로 처리됨. (API 응답이 너무 느림. avg 3~4초)
    - 회원가입은 성공해도, 이메일발송(외부 API)이 실패하면 회원가입이 실패함.
      - 이말은 즉슨 외부 서비스의 장애가 우리 서비스의 장애로 이어질 수 있다는 것.
    - 코드가 지저분해질 수 있음
      - 인증인가 패키지에 이메일 발송, 쿠폰 발급 코드가 섞여 있음.
